---
const links = [
  { name: "Libros", href: "/#libros" },
  { name: "Sobre mí", href: "/#bio" },
  { name: "Blog", href: "/blog" },
];
---

<nav id="main-nav" class="fixed top-0 left-0 w-full z-[100] transition-all duration-500 border-b border-transparent py-6 md:py-10">
  
  <div class="px-6 md:px-12 flex justify-between items-center max-w-7xl mx-auto">
    
    <a href="/" class="group flex flex-col justify-center">
      <span class="hidden md:block font-serif text-3xl text-ink tracking-tight font-medium group-hover:text-ink/70 transition-colors duration-300">
        María Esperanza<span class="text-dusty-rose">.</span>
      </span>
      <span id="nav-subtitle" class="hidden md:block font-sans text-[10px] uppercase tracking-[0.3em] text-ink/40 mt-1 ml-1 group-hover:tracking-[0.4em] transition-all duration-300">
        Gallegos
      </span>

      <div class="md:hidden font-serif text-2xl text-ink leading-none">
        <span class="block">María</span>
        <span class="block">Esperanza<span class="text-dusty-rose">.</span></span>
      </div>
    </a>

    <ul class="hidden md:flex gap-10 items-center">
      {links.map((link) => (
        <li>
          <a 
            href={link.href} 
            class="relative text-xs font-bold font-sans uppercase tracking-widest text-ink/60 hover:text-ink transition-colors py-2 group"
          >
            {link.name}
            <span class="absolute bottom-0 left-0 w-0 h-[1px] bg-dusty-rose transition-all duration-300 group-hover:w-full"></span>
          </a>
        </li>
      ))}
    </ul>

    <button id="menu-btn" class="md:hidden text-ink p-2 -mr-2 hover:bg-ink/5 rounded-full transition-colors" aria-label="Abrir menú">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="w-8 h-8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5" />
      </svg>
    </button>
  </div>

  <div id="menu-items" class="hidden absolute top-full left-0 w-full bg-paper/95 backdrop-blur-xl border-b border-ink/10 shadow-xl md:hidden">
    <ul class="flex flex-col text-center py-8 gap-6">
      {links.map((link) => (
        <li>
          <a 
            href={link.href} 
            class="text-sm font-bold font-sans uppercase tracking-widest text-ink/80 hover:text-dusty-rose transition-colors"
          >
            {link.name}
          </a>
        </li>
      ))}
    </ul>
  </div>

</nav>

<script>
  // 1. Envolvemos TODO en una función para poder reiniciarla
  function initNavbar() {
    
    // === LÓGICA DEL MENÚ MÓVIL ===
    const menuBtn = document.getElementById('menu-btn');
    const menuItems = document.getElementById('menu-items');

    // Limpiamos eventos anteriores para no duplicar (por seguridad)
    const newBtn = menuBtn?.cloneNode(true);
    if (menuBtn && newBtn) {
        menuBtn.parentNode.replaceChild(newBtn, menuBtn);
        
        newBtn.addEventListener('click', () => {
            menuItems?.classList.toggle('hidden');
        });
    }

    if (menuItems) {
        menuItems.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                menuItems.classList.add('hidden');
            });
        });
    }

    // === LÓGICA DEL SCROLL ===
    const nav = document.getElementById('main-nav');
    //const subtitle = document.getElementById('nav-subtitle');

    function updateNav() {
        if (!nav) return;

        if (window.scrollY > 20) {
            // SCROLLEADO: Activar clase CSS sólida
            nav.classList.add('nav-scrolled');
            
            nav.classList.remove('py-6', 'md:py-10', 'border-transparent');
            nav.classList.add('py-3');
            nav.classList.add('border-ink/5');

            //if(subtitle) subtitle.classList.add('opacity-0', '-translate-y-2');

        } else {
            // ARRIBA: Transparente
            nav.classList.remove('nav-scrolled');
            
            nav.classList.remove('py-3');
            nav.classList.remove('border-ink/5');
            nav.classList.add('py-6', 'md:py-10', 'border-transparent');

            //if(subtitle) subtitle.classList.remove('opacity-0', '-translate-y-2');
        }
    }

    // Remover listener anterior si existía para no acumular basura
    window.removeEventListener('scroll', updateNav);
    // Agregar nuevo listener
    window.addEventListener('scroll', updateNav);
    
    // Ejecutar una vez al inicio
    updateNav();
  }

  // 2. MAGIA DE ASTRO: Ejecutar cada vez que cambiamos de página
  document.addEventListener('astro:page-load', initNavbar);

</script>
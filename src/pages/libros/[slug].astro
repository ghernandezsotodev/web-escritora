---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// 1. Esto genera una página por cada archivo .md que tengas
export async function getStaticPaths() {
  const books = await getCollection('books');
  return books.map(book => ({
    params: { slug: book.slug },
    props: { book },
  }));
}

// 2. Recibimos los datos del libro
const { book } = Astro.props;
// 3. Renderizamos el texto largo (el cuento/historia)
const { Content } = await book.render();

const isNovela = book.data.category === 'novela';
---

<BaseLayout title={`${book.data.title} | María E. Gallegos`}>
  <main class="pt-20 pb-24 px-6 max-w-5xl mx-auto">
    
    <a href="/#libros" class="inline-flex items-center text-xs font-bold tracking-widest uppercase text-ink/40 hover:text-ink mb-12 transition-colors">
      &larr; Volver a la colección
    </a>

    <div class="grid grid-cols-1 md:grid-cols-12 gap-12 lg:gap-16">
      
      <div class="md:col-span-5 lg:col-span-4">
        <div class={`relative w-full shadow-2xl ${isNovela ? 'aspect-[2/3] rounded-sm' : 'aspect-[3/4] rounded-xl'} overflow-hidden bg-paper`}>
          <img 
            src={book.data.cover} 
            alt={book.data.title}
            class="w-full h-full object-cover"
            transition:name={`img-${book.slug}`} 
          />
        </div>

        <div class="mt-8 border-t border-ink/10 pt-6 space-y-3 font-sans text-sm text-ink/70">
          <div class="flex justify-between">
            <span>Publicado:</span>
            <span class="text-ink font-medium">
                {book.data.publishedAt.toLocaleDateString('es-ES', { year: 'numeric', month: 'long' })}
            </span>
          </div>
          <div class="flex justify-between">
            <span>Categoría:</span>
            <span class="capitalize text-ink font-medium">{book.data.category}</span>
          </div>
        </div>
      </div>

      <div class="md:col-span-7 lg:col-span-8">
        
        <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl text-ink mb-4 leading-none">
          {book.data.title}
        </h1>
        
        {book.data.subtitle && (
          <p class="font-serif text-xl md:text-2xl text-sage italic mb-10">
            {book.data.subtitle}
          </p>
        )}

        <div class="prose prose-stone prose-lg max-w-none text-ink/80 font-sans font-light leading-relaxed mb-12">
            <Content />
        </div>

        <div class="border-t border-ink/10 pt-8">
          <p class="text-sm text-ink/50 mb-4 italic font-serif">¿Te interesa leer la obra completa?</p>
          
          {book.data.buyLink ? (
            <a 
              href={book.data.buyLink} 
              target="_blank"
              class="inline-block px-8 py-4 bg-ink text-paper text-sm font-bold uppercase tracking-widest hover:bg-ink/80 transition-colors"
            >
              Comprar Online
            </a>
          ) : (
            <a 
              href={`mailto:correo-escritora@gmail.com?subject=Interés en libro: ${book.data.title}`}
              class="inline-block px-8 py-4 bg-dusty-rose text-ink text-sm font-bold uppercase tracking-widest hover:bg-sage transition-colors rounded-sm"
            >
              Solicitar a la autora
            </a>
          )}
        </div>

      </div>

    </div>
  </main>
</BaseLayout>